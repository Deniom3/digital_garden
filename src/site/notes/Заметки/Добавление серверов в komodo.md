---
{"dg-publish":true,"permalink":"/zametki/dobavlenie-serverov-v-komodo/","created":"2025-11-26 20:16","updated":"2025-11-26T23:51:23+03:00"}
---

Для подключения дополнительных серверов в [[Заметки/Self-hosting. Komodo\|Komodo]] необходимо запустить сервис periphery как службу или как [[Хобби/Docker compose/Komodo Agent\|докер контейнер]] . При установке как службу все файлы создаваемые из интерфейса и все контейнеры которые запускаются будут запущены от root пользователя.

Если необходимо ограниченые права для работы лучше использовать docker вариант. 
Для этого в предложенном docker compose необходимо заполнить:
	`UID` - id пользователя от чьего имени будут создаваться файлы  
	`DOCKER_GID` - id группы docker для запуска под ограниченными правами

> [!important] Важно
> Монтирование папок с файлами необходимо выполнять по полному пути и он должен соответвовать пути в контенере. 
> ...
>	volumes:
>		-  /opt/remnanode:/opt/remnanode
>		- /opt/caddy:/opt/caddy
>...

> [!bug] Ошибка мониторинга LXC
> При использовании docker варианта установки мониторинг потребления оперативной памяти и нагрузки на процессор работает не корректно

### Настройка в komodo

![Добавление серверов в komodo.png](/img/user/%D0%98%D1%81%D1%85%D0%BE%D0%B4%D0%BD%D0%B8%D0%BA%D0%B8/%D0%94%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%BE%D0%B2%20%D0%B2%20komodo.png)
Указать имя сервера, рекомендую использовать такое же как в переменной `SERVER_NAME` 

![Добавление серверов в komodo-1.png](/img/user/%D0%98%D1%81%D1%85%D0%BE%D0%B4%D0%BD%D0%B8%D0%BA%D0%B8/%D0%94%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%BE%D0%B2%20%D0%B2%20komodo-1.png)
Указываем адрес с протоколом https и включить сервер. В поле external adress указываем ip по которому будут доступны запускаемые сервисы для быстрого перехода.
Дополнительно в этом окне можно настроить параметры мониторинга.

![Добавление серверов в komodo-2.png](/img/user/%D0%98%D1%81%D1%85%D0%BE%D0%B4%D0%BD%D0%B8%D0%BA%D0%B8/%D0%94%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%BE%D0%B2%20%D0%B2%20komodo-2.png)
На закладке docker можно управлять конкретными контейнерам на сервере.

### Настройка очистки

Для сервера можно включить настройку `Auto Prune Images` для автоматической очистки не используемых образов.

> [!important] Важно
> Автоматическое обновление по умолчанию не очищает образы. Для очистки после обновления надо включить или функцию авто очистки или настроить отдельный `procedures`.

![Добавление серверов в komodo-4.png](/img/user/%D0%98%D1%81%D1%85%D0%BE%D0%B4%D0%BD%D0%B8%D0%BA%D0%B8/%D0%94%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%BE%D0%B2%20%D0%B2%20komodo-4.png)
### Использование тегов

Для удобства советую создавать теги по серверам (можно в тег дополнительно указать ip сервера). Тег можно назначить на docker compose stack и на сервер для удобных отборов.

Создаются теги в `Settings -> Tags`
![Добавление серверов в komodo-3.png](/img/user/%D0%98%D1%81%D1%85%D0%BE%D0%B4%D0%BD%D0%B8%D0%BA%D0%B8/%D0%94%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%BE%D0%B2%20%D0%B2%20komodo-3.png)

---
> [!urls]- Упоминания:
> - 